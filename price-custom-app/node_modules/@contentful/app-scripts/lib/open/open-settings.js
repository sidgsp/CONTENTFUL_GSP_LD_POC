"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.openSettings = exports.REDIRECT_URL = void 0;
const open_1 = __importDefault(require("open"));
const chalk_1 = __importDefault(require("chalk"));
const inquirer_1 = __importDefault(require("inquirer"));
const constants_1 = require("../constants");
exports.REDIRECT_URL = 'https://app.contentful.com/deeplink?link=app-definition';
async function openSettings(options) {
    let definitionId;
    if (options.definitionId) {
        definitionId = options.definitionId;
    }
    else if (process.env[constants_1.APP_DEF_ENV_KEY]) {
        definitionId = process.env[constants_1.APP_DEF_ENV_KEY];
    }
    else {
        const prompts = await inquirer_1.default.prompt([
            {
                name: 'definitionId',
                message: `The id of the app:`,
            },
        ]);
        definitionId = prompts.definitionId;
    }
    console.log(definitionId, 'DEFID');
    console.log(options, 'options');
    console.log(process.env[constants_1.APP_DEF_ENV_KEY], 'process.env[APP_DEF_ENV_KEY]');
    if (!definitionId) {
        console.log(`
        ${chalk_1.default.red('Error:')} There was no app-definition defined.

        Please add it with ${chalk_1.default.cyan('--definition-id=<app-definition-id>')}
        or set the environment variable ${chalk_1.default.cyan(`${constants_1.APP_DEF_ENV_KEY} = <app-definition-id>`)}
      `);
        throw new Error('No app-definition-id');
    }
    try {
        (0, open_1.default)(`${exports.REDIRECT_URL}&id=${definitionId}`);
    }
    catch (err) {
        console.log(`${chalk_1.default.red('Error:')} Failed to open browser`);
        console.log(err.message);
        throw err;
    }
}
exports.openSettings = openSettings;
